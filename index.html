<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>コスモスくんAR撮影</title>
<style>
  html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
  #camera { display: none; }
  #canvas { width: 100%; height: 100%; display: block; }
  #btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 20;
    font-size: 18px;
    padding: 8px 12px;
    background-color: rgba(255,255,255,0.8);
    border: 1px solid #ccc;
    border-radius: 5px;
  }
</style>
</head>
<body>
<video id="camera" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<button id="btn">撮影</button>
<img id="cosmos" src="cosmoskun.PNG" style="display:none;">

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const btn = document.getElementById('btn');
const cosmos = document.getElementById('cosmos');

// カメラ起動
navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
.then(stream => {
  video.srcObject = stream;
  video.onloadedmetadata = () => {
    video.play();
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;
    drawFrame();
  };
})
.catch(err => alert('カメラを起動できません: ' + err));

// 毎フレーム描画
function drawFrame() {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  // コスモスくんを右下に固定
  const w = 150; // 幅固定
  const h = w * (cosmos.naturalHeight / cosmos.naturalWidth);
  ctx.drawImage(cosmos, canvas.width - w - 20, canvas.height - h - 20, w, h);
  requestAnimationFrame(drawFrame);
}

// 撮影ボタン
btn.addEventListener('click', () => {
  const dataURL = canvas.toDataURL('image/png');
  const link = document.createElement('a');
  link.href = dataURL;
  link.download = 'cosmos_photo.png';
  link.click();
});
</script>
</body>
</html>
