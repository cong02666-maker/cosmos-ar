<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<title>コスモスくんAR撮影（大きめ）</title>
<style>
  html, body { margin: 0; padding: 0; height: 100%; overflow: hidden; }
  #camera { display: none; }
  #canvas { width: 100%; height: 100%; display: block; }
  #btn {
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 20;
    font-size: 18px;
    padding: 8px 12px;
    background-color: rgba(255,255,255,0.8);
    border: 1px solid #ccc;
    border-radius: 5px;
  }
  #snapshot {
    position: fixed;
    top: 80px;
    left: 20px;
    max-width: 200px;
    border: 2px solid #ccc;
    display: none;
    z-index: 20;
  }
</style>
</head>
<body>
<video id="camera" autoplay playsinline></video>
<canvas id="canvas"></canvas>
<button id="btn">撮影</button>
<img id="snapshot" alt="撮影画像">
<img id="cosmos" src="20250922.png" style="display:none;">

<script>
const video = document.getElementById('camera');
const canvas = document.getElementById('canvas');
const ctx = canvas.getContext('2d');
const btn = document.getElementById('btn');
const snapshotImg = document.getElementById('snapshot');
const cosmos = document.getElementById('cosmos');

// カメラ起動
navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } })
.then(stream => {
  video.srcObject = stream;
  video.onloadedmetadata = () => {
    video.play();
    // canvasを動画の2倍解像度に設定して高画質化
    canvas.width = video.videoWidth * 2;
    canvas.height = video.videoHeight * 2;
    drawFrame();
  };
})
.catch(err => alert('カメラを起動できません: ' + err));

// 毎フレーム描画
function drawFrame() {
  ctx.drawImage(video, 0, 0, canvas.width, canvas.height);
  // コスモスくんを右下に大きめ表示（画面幅の1/3）
  const w = canvas.width / 3; 
  const h = w * (cosmos.naturalHeight / cosmos.naturalWidth);
  ctx.drawImage(cosmos, canvas.width - w - 40, canvas.height - h - 40, w, h);
  requestAnimationFrame(drawFrame);
}

// 撮影ボタン
btn.addEventListener('click', () => {
  const dataURL = canvas.toDataURL('image/png');
  snapshotImg.src = dataURL;
  snapshotImg.style.display = 'block';
  alert("画像が表示されました。\n長押しでカメラロールに保存できます。");
});
</script>
</body>
</html>
